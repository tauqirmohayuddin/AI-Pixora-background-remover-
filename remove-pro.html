<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Pixora Pro — Background Remover</title>
  <meta name="robots" content="noindex">
  <style>
    :root{
      --accent:#1e88e5;
      --bg:#0f1724;
      --card:#0b1220;
      --card-2:#0f1724;
      --text:#e6eef8;
      --muted:#9fb1cf;
      --radius:14px;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071029 0%, #091426 100%);font-family:Inter, Arial, sans-serif;color:var(--text)}
    .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box}
    .card{width:100%;max-width:920px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:24px;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 6px 0;color:var(--accent);font-size:1.6rem}
    p.lead{margin:0 0 16px 0;color:var(--muted)}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    input[type=file]{background:transparent;color:var(--text);padding:10px;border-radius:10px;border:1px dashed rgba(255,255,255,0.06)}
    button{background:var(--accent);color:#fff;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    button[disabled]{opacity:.6;cursor:not-allowed}
    #loader{display:none;margin:14px auto;border:4px solid rgba(255,255,255,0.06);border-top:4px solid var(--accent);width:40px;height:40px;border-radius:50%;animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    #resultWrap{margin-top:18px;display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
    #resultView{flex:1;min-width:260px}
    #resultImg{max-width:100%;border-radius:10px;display:none;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    #status{color:var(--muted);margin-top:8px;font-size:0.95rem}
    .download{display:inline-block;margin-top:8px;padding:8px 12px;background:#0b1220;color:var(--text);text-decoration:none;border-radius:10px}
    footer{margin-top:18px;color:#9fb1cf;font-size:0.85rem;text-align:center}
    .muted{color:var(--muted)}
    @media (max-width:640px){ .controls{flex-direction:column;align-items:stretch} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="main">
      <h1>AI Pixora Pro</h1>
      <p class="lead">Upload a photo and remove the background quickly. This demo uses a Netlify function to call the background-removal API.</p>

      <div class="controls">
        <input id="fileInput" type="file" accept="image/*" />
        <button id="removeBtn">Remove Background</button>
        <button id="testBtn" style="background:#2f855a">Connectivity test</button>
      </div>

      <div id="loader" aria-hidden="true"></div>

      <div id="status" role="status" aria-live="polite">Status: idle</div>

      <div id="resultWrap">
        <div id="resultView">
          <img id="resultImg" alt="Result image" />
          <div><a id="downloadBtn" class="download" style="display:none">⬇ Download result</a></div>
        </div>
        <pre id="rawOut" style="background:#021124;color:#9fb1cf;padding:12px;border-radius:8px;min-width:260px;max-height:340px;overflow:auto">Console output and server messages will appear here.</pre>
      </div>

      <footer>© 2025 AI Pixora Pro — Demo</footer>
    </div>
  </div>

<script>
(function(){
  const NETLIFY_URL = '/.netlify/functions/remove-bg'; // correct endpoint for Netlify functions
  const fileInput = document.getElementById('fileInput');
  const removeBtn = document.getElementById('removeBtn');
  const testBtn = document.getElementById('testBtn');
  const loader = document.getElementById('loader');
  const status = document.getElementById('status');
  const resultImg = document.getElementById('resultImg');
  const downloadBtn = document.getElementById('downloadBtn');
  const rawOut = document.getElementById('rawOut');

  function log(text){
    console.log(text);
    rawOut.textContent = (new Date()).toISOString() + " — " + text + "\n\n" + rawOut.textContent;
  }
  function setStatus(t){ status.textContent = "Status: " + t; log(t); }
  function showLoader(on){ loader.style.display = on ? 'block' : 'none'; }

  // Expose for console tests
  window.testFunc = async function(){
    setStatus('Running connectivity test (empty POST) to ' + NETLIFY_URL);
    showLoader(true);
    try{
      const res = await fetch(NETLIFY_URL, { method: 'POST' });
      const txt = await res.text().catch(()=>'<non-text response>');
      setStatus('Connectivity test returned: ' + res.status + ' ' + res.statusText);
      log('Response headers: ' + JSON.stringify(Object.fromEntries(res.headers.entries())));
      log('Body (first 4000 chars): ' + (txt ? txt.slice(0,4000) : '(empty)'));
      return { status: res.status, body: txt };
    }catch(err){
      setStatus('Connectivity test failed');
      log('Connectivity error: ' + String(err));
      return { error: String(err) };
    }finally{
      showLoader(false);
    }
  };

  // test button triggers the same
  testBtn.addEventListener('click', ()=>{ window.testFunc(); });

  removeBtn.addEventListener('click', async ()=>{
    if (!fileInput.files || fileInput.files.length === 0) {
      setStatus('Please choose an image first.');
      return;
    }
    const file = fileInput.files[0];
    setStatus('Uploading & processing: ' + file.name);
    showLoader(true);
    resultImg.style.display = 'none';
    downloadBtn.style.display = 'none';

    try{
      const fd = new FormData();
      fd.append('image_file', file); // remove.bg expects image_file
      fd.append('size','auto');

      const res = await fetch(NETLIFY_URL, { method: 'POST', body: fd });
      setStatus('Server returned: ' + res.status + ' ' + res.statusText);

      if (!res.ok) {
        const t = await res.text().catch(()=>'<non-text>');
        log('Server error body: ' + t.slice(0,2000));
        setStatus('Server error: ' + res.status);
        showLoader(false);
        return;
      }

      // response is image binary, create blob and show
      const blob = await res.blob();
      const url = URL.createObjectURL(blob);
      resultImg.src = url;
      resultImg.style.display = 'block';
      downloadBtn.href = url;
      downloadBtn.style.display = 'inline-block';
      downloadBtn.onclick = ()=>{ /* allow user to download via link */ };
      setStatus('Background removed successfully!');
      log('Received image, size: ' + blob.size + ', type: ' + blob.type);
    }catch(err){
      log('Client error: ' + String(err));
      setStatus('Client error: ' + String(err));
    }finally{
      showLoader(false);
    }
  });

  // small page-ready log
  log('Client script loaded. NETLIFY_URL=' + NETLIFY_URL);
})();
</script><script src="/.netlify/functions/remove-bg.js"></script>
</body>
</html>
